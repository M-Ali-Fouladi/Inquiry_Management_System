
@model CustomMembershipEF.Models.tbl_InquiryNew

@{
    ViewBag.Title = "Update";
}
<script type="text/javascript">
    $(function () {
        $('.VaredehDate').datepicker();
        $('.SabtDate').datepicker();
    });
</script>


<h2>ویرایش </h2>

@using (@Ajax.BeginForm("_Update_Operation", "Home", new AjaxOptions() { UpdateTargetId = "result", OnFailure = "AjaxFailure", OnBegin = "AjaxBegin", OnComplete = "AjaxComplete" }, new { id = "DabirKhanehForm" }))
{

    <div>
    

        <legend class="legend">ویرایش</legend>


        @*@Html.HiddenFor(model => model.InquiryID)*@
        <input type="checkbox" name="Inquiry_Confirmed" value="true"> تایید درخواست<br>
        <input type="checkbox" name="Inquiry_Rejected" value="true"> رد درخواست<br>
        <input type="checkbox" name="Inquiry_OutSource" value="true"> خارج از سازمان<br>
        @*<input type="submit" value="Submit">*@


        <div>


            @Html.LabelFor(model => model.Inquiry_Primary_Date)
            @Html.TextBoxFor(model => model.Inquiry_Primary_Date, new { @onclick = "PersianDatePicker.Show(this, '1397/01/01')" })
        </div>

        <div>
            @Html.Label("نام کارشناس آزمایشگاه")
            @(Html.Kendo().DropDownListFor(model => model.Inquiry_Related_Agent)
                                          .Name("Inquiry_Related_Agent")
                                          .DataTextField("AdminUserName")
                                          .DataValueField("AdminID")
                                          .DataSource(source =>
                                          {
                                              source.Read(read =>
                                              {
                                                  read.Action("GetAdminDropdown", "Home");
                                              });
                                          })
                                          .HtmlAttributes(new { style = "width: 100%" })
            )
            @* from tbl admin *@
        </div>

        <div>

            @Html.LabelFor(model => model.Inquiry_Main_ID)
            @Html.TextBoxFor(model => model.Inquiry_Main_ID, new { @class = "input full-width" })

        </div>

        <div title="نوع درخواست">

            <fieldset id="group1">
                <input type="radio" name="Inquiry_Type" value="1">داخلی <br>
                <input type="radio" name="Inquiry_Type" value="2">خارجی<br>
            </fieldset>

        </div>

        <div>
            @Html.LabelFor(model => model.Inquiry_Name)
            @(Html.Kendo().DropDownListFor(model => model.Inquiry_Name)
                                          .Name("Inquiry_Name")
                                          .DataTextField("FullName")
                                          .DataValueField("Id")
                                          .DataSource(source =>
                                          {
                                              source.Read(read =>
                                              {
                                                  read.Action("GetInquiryNameDropdown", "Home");
                                              });
                                          })
                                          .HtmlAttributes(new { style = "width: 100%" })
            )
        </div>

        <div>
            @Html.LabelFor(model => model.Inquiry_Vahed)
            @(Html.Kendo().DropDownListFor(model => model.Inquiry_Vahed)
                                          .Name("Inquiry_Vahed")
                                          .DataTextField("WorkSectionTitle")
                                          .DataValueField("WorkSectionID")
                                          .DataSource(source =>
                                          {

                                              source.Read(read =>
                                              {
                                                  read.Action("GetInquiryVahedDropdown", "Home");
                                              });
                                          })
                                          .HtmlAttributes(new { style = "width: 100%" })
            )

        </div>

        <div>
            @Html.LabelFor(model => model.Inquiry_Date)
            @Html.TextBoxFor(model => model.Inquiry_Date, new { @onclick = "PersianDatePicker.Show(this, '1397/01/01')" })

        </div>
        <div>
            @Html.LabelFor(model => model.Inquiry_NeededDate)
            @Html.TextBoxFor(model => model.Inquiry_NeededDate, new { @onclick = "PersianDatePicker.Show(this, '1397/01/01')" })


        </div>
        <div>
            @Html.LabelFor(model => model.Inquiry_Element_Code)
            @*@Html.DropDownListFor(model => model.Inquiry_Element_Code, (SelectList)ViewBag.Amniat)*@

        </div>
        <div>
            @Html.LabelFor(model => model.Inquiry_Tech_Code)
            @Html.TextBoxFor(model => model.Inquiry_Tech_Code, new { @class = "input full-width" })

        </div>

        <div>
            @Html.LabelFor(model => model.Inquiry_Element)
            @Html.TextBoxFor(model => model.Inquiry_Element, new { @class = "input full-width" })

        </div>
        <div>
            @Html.LabelFor(model => model.Inquiry_Scale)
            @Html.TextBoxFor(model => model.Inquiry_Scale, new { @class = "input full-width" })

        </div>
        <div>
            @Html.LabelFor(model => model.Inquiry_Count)
            @Html.TextBoxFor(model => model.Inquiry_Count, new { @class = "input full-width" })

        </div>

        <div>
            @Html.Label("نوع قطعه")
            <fieldset id="group1">
                <input type="radio" name="Inquiry_Element_Type" value="1">محصول نهایی <br>
                <input type="radio" name="Inquiry_Element_Type" value="2">پروژه ایی<br>
                <input type="radio" name="Inquiry_Element_Type" value="3"> قطعه کنترلی<br>
            </fieldset>
        </div>
        <div>
            @Html.LabelFor(model => model.Inquiry_Map_Code)
            @Html.TextBoxFor(model => model.Inquiry_Map_Code, new { @class = "input full-width" })

        </div>
        <div>
            @Html.LabelFor(model => model.Inquiry_Trace_Code)
            @Html.TextBoxFor(model => model.Inquiry_Trace_Code, new { @class = "input full-width" })

        </div>
        <div>
            @Html.LabelFor(model => model.Inquiry_Client_Desc)
            @Html.TextAreaFor(model => model.Inquiry_Client_Desc, new { @class = "img-shadow" })
        </div>
     
        <div class="columns">
            <div class="eight-columns twelve-columns-tablet">
                @*<button id="Update" class="button blue-gradient" type="submit">ذخیــره</button>*@
                <input type="submit" value="ثبت تغییرات">
            </div>
        </div>
    </div>

    }
<script>
    function AjaxBegin() {

    }

    function AjaxComplete(result) {
        alert("Completed")

    }

    function AjaxFailure(ajaxContext) {
        var response = ajaxContext.responseText;
        alert("Error Code [" + ajaxContext.ErrorCode + "] " + response);
    }

</script>
@(Html.Kendo().Grid<CustomMembershipEF.Models.Test_Inquiry_Viewmodel>()
            .Name("Grid2")

            .Columns(columns =>
            {
                columns.Bound(c => c.Id);
                columns.Bound(c => c.Test_UID);
                columns.Bound(c => c.Test_Subject);
                columns.Bound(c => c.Test_Standard_Code);
                columns.Command(command => command.Custom("بررسی آزمون").Click("showDetails2")).Width(200);
            })

            .DataSource(dataSource => dataSource
                .Ajax()
                .PageSize(20)

                    .Read(read => read.Action("Popup_Read_Kartable", "Home"))
                )
)

<br />



    @*id="Test_Inquiry_Form"*@
    @*<input name="PersianDatePicker" type="text" onclick="PersianDatePicker.Show(this, '1397/01/01')">تاریخ شروع آزمایش :
    <input name="PersianDatePicker" type="text" onclick="PersianDatePicker.Show(this, '1397/01/01')">تاریخ پایان آزمایش :*@

    <div id="Test_Inquiry_Form">
            @*@Html.LabelFor(model => model.Inquiry_NeededDate)*@
            <br />    <input type="hidden" id="Test_Inquiry_ID">
                      <input type="hidden" id="Test_ID">

            <input type="text" id="Test_Inquiry_Start_Date">تاریخ آغاز آزمایش :<br>
            <input type="text" id="Test_Inquiry_Done_Date">تاریخ پایان آزمایش :<br>

            <input type="text" id="Test_Inquiry_Start_Time">زمان آغاز آزمایش :<br>
            <input type="text" id="Test_Inquiry_Done_Time">زمان پایان آزمایش :<br>
            <input type="text" id="Test_Ghatiat">عدم قطعیت :<br>
            @*PersianDatePicker.Show(this, '1397/01/01')*@
            <input type="text" id="Inquiry_Element_Alamat_Azmoon">علامت آزمون :<br>
            <input type="text" id="Test_NafarSaat">تعداد نفر صرف شده :<br>
            <input type="text" id="Inquiry_Element_Rahgiri">کد رهیابی آزمایشگاه :<br>

            <input type="text" id="Inquiry_Name">تجهیزات مورد استفاده :<br>
            <input type="text" id="Inquiry_Name">مواد مورد استفاده :<br>
            <input type="text" id="Inquiry_Name">فایل ضمیمه :<br>

            <input type="text" id="Test_Inquiry_Way_Desc">روش انجام آزمایش :<br>
            <input type="text" id="Test_Acception_Description">معیار پذیرش آزمایش :<br>
            <input type="text" id="Test_Inquiry_Result">نتیجه آزمایش :<br>
            <input type="text" id="Test_Inquiry_Desc">توضیحات :<br>

            <fieldset id="group1">
                <input type="radio" name="rd" id="Test_Inquiry_Final_Status" value="true">موفقیت آمیز <br>
                <input type="radio" name="rd" id="Test_Inquiry_Final_Status" value="false">عدم موفقیت<br>
            </fieldset>

            @*<button onclick="search()" class="button blue-gradient">جستجو</button>*@
            <input type="button" id="btnSave" value="ثبت تغییرات" onclick="search()" />
    </div>
    <script>
        var Test_Inquiry_PreStart_Date;
        var Test_Inquiry_PreDone_Date;
        function StartExam() {
            
            if ($("#Test_Inquiry_PreStart_Date").val() != "" && $("#Test_Inquiry_PreDone_Date").val() != "")
            {
                
                Test_Inquiry_PreStart_Date = $("#Test_Inquiry_PreStart_Date").val();
                Test_Inquiry_PreDone_Date = $("#Test_Inquiry_PreDone_Date").val();
                $("#Grid2").hide();
                $("#predate_form").hide();
                $("#btn_show_grid").show();
                $("#Test_Inquiry_Form").show();

            }
            else {
                $("#star1").show();
                $("#star2").show();
                alert("لطفا ابتدا تاریخ آغاز و پایان پیش بینی را واد نمایید.")
            }
        }
       
        function search() {
            $("#btn_show_grid").show();
            var Test_Inquiry_PreStart_Date = $("#Test_Inquiry_PreStart_Date").val();
            var Test_Inquiry_PreDone_Date = $("#Test_Inquiry_PreDone_Date").val();

            var Test_Inquiry_Start_Date = $("#Test_Inquiry_Start_Date").val();
            var Test_Inquiry_Done_Date = $("#Test_Inquiry_Done_Date").val();
            var Test_Inquiry_Start_Time = $("#Test_Inquiry_Start_Time").val();
            var Test_Inquiry_Done_Time = $("#Test_Inquiry_Done_Time").val();
            
            var Test_ID = $("#Test_ID").val();
            var Test_Inquiry_ID = $("#Test_Inquiry_ID").val();
            var Test_Ghatiat = $("#Test_Ghatiat").val();
            var Inquiry_Element_Alamat_Azmoon = $("#Inquiry_Element_Alamat_Azmoon").val();
            var Test_NafarSaat = $("#Test_NafarSaat").val();
            var Inquiry_Element_Rahgiri = $("#Inquiry_Element_Rahgiri").val();
            var Test_Inquiry_Way_Desc = $("#Test_Inquiry_Way_Desc").val();
            var Test_Acception_Description = $("#Test_Acception_Description").val();
            var Test_Inquiry_Result = $("#Test_Inquiry_Result").val();
            var Test_Inquiry_Desc = $("#Test_Inquiry_Desc").val();
            var Test_Inquiry_Final_Status = $("#Test_Inquiry_Final_Status").val();
            $.ajax({
                url: '/Home/Update_Operation_Partial',
                dataType: "json",
                type: "POST",
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({
                    model: {
                        Inquiry_TestId: Test_Inquiry_ID, Test_Inquiry_Start_Date: Test_Inquiry_Start_Date,
                        Test_Inquiry_Done_Date: Test_Inquiry_Done_Date, Test_Ghatiat: Test_Ghatiat, Inquiry_Element_Alamat_Azmoon: Inquiry_Element_Alamat_Azmoon,
                        Test_NafarSaat: Test_NafarSaat, Inquiry_Element_Rahgiri: Inquiry_Element_Rahgiri,
                        Test_Inquiry_Way_Desc: Test_Inquiry_Way_Desc, Test_Acception_Description: Test_Acception_Description,
                        Test_Inquiry_Result: Test_Inquiry_Result, Test_Inquiry_Desc: Test_Inquiry_Desc,
                        Test_Inquiry_Final_Status: Test_Inquiry_Final_Status, Test_Inquiry_Start_Time: Test_Inquiry_Start_Time,
                        Test_Inquiry_Done_Time: Test_Inquiry_Done_Time, Test_Inquiry_PreStart_Date: Test_Inquiry_PreStart_Date,
                        Test_Inquiry_PreDone_Date: Test_Inquiry_PreDone_Date, Test_ID: Test_ID}
                }),
                async: true,
                processData: false,
                cache: false,
                success: function (data) {
                    
                    alert('عملیات تایید صدور درخواست با موفقیت انجام شد');
                    var grid = $("#Grid2").data("kendoGrid");
                    grid.dataSource.read();
                    ShowGrid();
                    $("#btn_show_grid").show();
                   
                },
                error: function (xhr) {
                     alert('مشکلی در ثبت تغییرات صورت گرفته است.');
                   // alert('error');
                }
            })
        }
    </script>
    @*<input type="button" id="btnSave" value="ثبت تغییرات" ng-click="search(Test_Inquiry_ID,Test_Inquiry_Start_Date,Test_Inquiry_Done_Date
           Test_Ghatiat,Inquiry_Element_Alamat_Azmoon,Test_NafarSaat,Inquiry_Element_Rahgiri,
           Test_Inquiry_Way_Desc,Test_Acception_Description,Test_Inquiry_Result,
           Test_Inquiry_Desc,Test_Inquiry_Final_Status)" />*@
 

<div id="predate_form">
    <div id="star1">*</div><input type="text" id="Test_Inquiry_PreStart_Date">تاریخ پیش بینی آغاز :<br>
    <div id="star2">*</div><input type="text" id="Test_Inquiry_PreDone_Date">تاریخ پیش بینی پایان :<br>
    <input onclick="StartExam()" type="button" id="start_exam" value="ثبت پیش بینی و آغاز آزمون" />
</div>
<input onclick="ShowGrid()" type="button" id="btn_show_grid" value="انصراف" />
    <script type="text/javascript">
        $("#Test_Inquiry_Form").hide();
        $("#predate_form").hide();
        $("#star1").hide();
        $("#star2").hide();
       
        //document.getElementById("cancel_desc").value = "";
        
       
   // var detailsTemplate = kendo.template($("#template").html());
    function showDetails2(e) {
        e.preventDefault();
        var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
        if (dataItem.Test_Inquiry_PreDone_Date != "")
        {
            $("#btn_show_grid").show();
            $("#Test_Inquiry_Form").show(); 
            $("#Grid2").hide();
            $("#star1").hide();
            $("#star2").hide();

            $("#Test_Inquiry_Start_Date").val(dataItem.Test_Inquiry_Start_Date);
            $("#Test_Inquiry_ID").val(dataItem.Inquiry_TestId);
            $("#Test_ID").val(dataItem.Test_ID);
           
            $("#Test_Inquiry_Done_Date").val(dataItem.Test_Inquiry_Done_Date);
            $("#Test_Inquiry_Start_Time").val(dataItem.Test_Inquiry_Start_Time);
            $("#Test_Inquiry_Done_Time").val(dataItem.Test_Inquiry_Done_Time);

            $("#Test_Ghatiat").val(dataItem.Test_Ghatiat);
            $("#Inquiry_Element_Alamat_Azmoon").val(dataItem.Inquiry_Element_Alamat_Azmoon);
            $("#Test_NafarSaat").val(dataItem.Test_NafarSaat);
            $("#Inquiry_Element_Rahgiri").val(dataItem.Inquiry_Element_Rahgiri);
            $("#Test_Inquiry_Way_Desc").val(dataItem.Test_Inquiry_Way_Desc);
            $("#Test_Acception_Description").val(dataItem.Test_Acception_Description);
            $("#Test_Inquiry_Result").val(dataItem.Test_Inquiry_Result);
            $("#Test_Inquiry_Desc").val(dataItem.Test_Inquiry_Desc);
            $("#Test_Inquiry_Final_Status").val(dataItem.Test_Inquiry_Final_Status);

             //Test_Inquiry_Start_Date = document.getElementById("Test_Inquiry_Start_Date").value();
             //Test_Inquiry_ID = document.getElementById("Test_Inquiry_ID").value();
             //Test_Inquiry_Done_Date = document.getElementById("Test_Inquiry_Done_Date").value();
             //Test_Ghatiat = document.getElementById("Test_Ghatiat").value();
             //Inquiry_Element_Alamat_Azmoon = document.getElementById("Inquiry_Element_Alamat_Azmoon").value();
             //Test_NafarSaat = document.getElementById("Test_NafarSaat").value();
             //Inquiry_Element_Rahgiri = document.getElementById("Inquiry_Element_Rahgiri").value;
             //Test_Inquiry_Way_Desc = document.getElementById("Test_Inquiry_Way_Desc").value;
             //Test_Acception_Description = document.getElementById("Test_Acception_Description").value;
             //Test_Inquiry_Result = document.getElementById("Test_Inquiry_Result").value;
             //Test_Inquiry_Desc = document.getElementById("Test_Inquiry_Desc").value;
             //Test_Inquiry_Final_Status = document.getElementById("Test_Inquiry_Final_Status").value;
        }
        else
        {
            $("#Test_Inquiry_ID").val(dataItem.Inquiry_TestId);
            $("#Test_ID").val(dataItem.Test_ID);
            $("#btn_show_grid").show();

            $("#Grid2").hide();
            $("#predate_form").show();
            $("#ShowGrid").hide();
          //  $("#btn_show_grid").show();

            //Test_Inquiry_Start_Date = document.getElementById("Test_Inquiry_Start_Date").value();
            //Test_Inquiry_ID = document.getElementById("Test_Inquiry_ID").value();
            //Test_Inquiry_Done_Date = document.getElementById("Test_Inquiry_Done_Date").value();
            //Test_Ghatiat = document.getElementById("Test_Ghatiat").value();
            //Inquiry_Element_Alamat_Azmoon = document.getElementById("Inquiry_Element_Alamat_Azmoon").value;
            //Test_NafarSaat = document.getElementById("Test_NafarSaat").value;
            //Inquiry_Element_Rahgiri = document.getElementById("Inquiry_Element_Rahgiri").value;
            //Test_Inquiry_Way_Desc = document.getElementById("Test_Inquiry_Way_Desc").value;
            //Test_Acception_Description = document.getElementById("Test_Acception_Description").value;
            //Test_Inquiry_Result = document.getElementById("Test_Inquiry_Result").value;
            //Test_Inquiry_Desc = document.getElementById("Test_Inquiry_Desc").value;
            //Test_Inquiry_Final_Status = document.getElementById("Test_Inquiry_Final_Status").value;
         

            
            
        }

        //$("#btn_show_grid").show();
        
        }
    </script>
<script>
    function ShowGrid()
    {
        $("#btn_show_grid").hide();
        $("#Test_Inquiry_Form").hide(); 
        $("#predate_form").hide();
        $("#Grid2").show();
        $("#star1").hide(); 
        $("#star2").hide();
    }
  
</script>
<script>
  
</script>
<script>
        //var app = angular.module("sortApp", []);
        //app.controller("mainController", function ($scope,$Http) {
          
        //    debugger;
           // $scope.search = function (Test_Inquiry_ID, Test_Inquiry_Start_Date, Test_Inquiry_Done_Date,
           //Test_Ghatiat, Inquiry_Element_Alamat_Azmoon, Test_NafarSaat, Inquiry_Element_Rahgiri,
           //     Test_Inquiry_Way_Desc, Test_Acception_Description, Test_Inquiry_Result,
           //     Test_Inquiry_Desc, Test_Inquiry_Final_Status)
            //  $scope.search = function()
            //{
            //    alert('');
                //$scope.user = {}
                //$scope.user.Test_Inquiry_ID = $('#Test_Inquiry_ID').val();

                //$scope.user.Test_Inquiry_Start_Date = $('#Test_Inquiry_Start_Date').val();
                //$scope.user.Test_Inquiry_Start_Date = $('#Test_Inquiry_Done_Date').val();
                //$scope.user.Test_Ghatiat = $('#Test_Ghatiat').val();
                //$scope.user.Inquiry_Element_Alamat_Azmoon = $('#Inquiry_Element_Alamat_Azmoon').val();
                //$scope.user.Test_NafarSaat = $('#Test_NafarSaat').val();
                //$scope.user.Inquiry_Element_Rahgiri = $('#Inquiry_Element_Rahgiri').val();
                //$scope.user.Test_Inquiry_Way_Desc = $('#Test_Inquiry_Way_Desc').val();
                //$scope.user.Test_Acception_Description = $('#Test_Acception_Description').val();
                //$scope.user.Test_Inquiry_Result = $('#Test_Inquiry_Result').val();
                //$scope.user.Test_Inquiry_Desc = $('#Test_Inquiry_Desc').val();
                //$scope.user.Test_Inquiry_Final_Status = $('#Test_Inquiry_Final_Status').val();
                @*$http({
                    url: '@Url.Action("Update_Operation_Partial", "Home")',
                    method: "POST",
                    data: JSON.stringify($scope.user)*@
             //   })
                //    .then(function (response) {
                        // success
                  //      alert('success');
                        //var grid = $("#grid").data("kendoGrid");
                        //grid.dataSource.read();
                        //$scope.users = response.data;
               //     },
                    //function (response) { // optional
                    //    // failed
                    //    alert("Error Occur");
                    //})

       //     };

      //  });
</script>



